/**
 ***********************************************************************************************************************
 * Company: Esme Sudria
 * Project: Projet Esme
 *
 ***********************************************************************************************************************
 * @file      MCP9700.c
 *
 * @author    <yourName>
 * @date      <date>
 *
 * @version   0.0.0
 *
 * @brief     <you can add a description of your module here, otherwise please delete this line>
 * @details   <you can add more details of your module here, otherwise please delete this line>
 *
 * @remark    Coding Language: C
 *
 * @copyright Copyright (c) 2024 This software is used for education proposal
 *
 ***********************************************************************************************************************
 */



/**********************************************************************************************************************/
/* INCLUDE FILES                                                                                                      */
/**********************************************************************************************************************/
#include <xc.h>
#include "ADC.h"
#include "MCP9700.h"

/**********************************************************************************************************************/
/* CONSTANTS, MACROS                                                                                                  */
/**********************************************************************************************************************/

#define ADC_TIMEOUT 100
#define ADC_MAX_VALUE 558
#define ADC_MIN_VALUE 31
#define TEMP_MIN -40
#define TEMP_MAX 125

/**********************************************************************************************************************/
/* TYPES                                                                                                              */
/**********************************************************************************************************************/



/**********************************************************************************************************************/
/* PRIVATE VARIABLES                                                                                                  */
/**********************************************************************************************************************/



/**********************************************************************************************************************/
/* PRIVATE FUNCTION PROTOTYPES                                                                                       */
/**********************************************************************************************************************/



/**********************************************************************************************************************/
/* PRIVATE FUNCTION DEFINITIONS                                                                                       */
/**********************************************************************************************************************/



/**********************************************************************************************************************/
/* PUBLIC FUNCTION DEFINITIONS                                                                                        */
/**********************************************************************************************************************/

int16_t MCP9700_GetTemperature(void){
    
    uint16_t adc_value;
    uint16_t * adc_value_ptr = &adc_value;
    int16_t temperature;
    
    if (ADC_enuGetRawValue(adc_value_ptr,ADC_TIMEOUT) == ADC_eSTATUS_OK){
            
        if (adc_value < ADC_MIN_VALUE){
            return TEMP_MIN;
        } else if (adc_value > ADC_MAX_VALUE){
            return TEMP_MAX;
        } else {
            temperature = (int16_t)(TEMP_MIN + ((int32_t)(adc_value - ADC_MIN_VALUE) * (TEMP_MAX - TEMP_MIN)) / (ADC_MAX_VALUE - ADC_MIN_VALUE));
            return temperature;
        }
    } else {
        return -128;
    }
    
}

/*--------------------------------------------------------------------------------------------------------------------*/

